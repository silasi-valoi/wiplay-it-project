{"ast":null,"code":"var _jsxFileName = \"/home/silasi/Deprojectos/javascript_projects/wiplay-it-web-frontend/src/containers/higher-order-components/main.js\";\nimport React from 'react';\nimport { ModalManager } from 'react-dynamic-modal';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport { handleSubmit, getCurrentUser, getPost, getUserList, getUserProfile, getPostList, getQuestion, getReplyList, getReplyChildrenList, getQuestionList as _getQuestionList, getCommentList, getIndex } from \"dispatch/index\";\nimport * as action from 'actions/actionCreators';\nimport { ModalOptionsMenu } from \"components/buttons\";\nimport { DropImage } from \"containers/profile/edit_profile\";\nimport AppEditor from 'containers/editor';\nimport { store } from \"index\";\nimport Modals from \"containers/modal-conf\";\nimport Helper from 'containers/utils/helpers';\nconst helper = new Helper();\nexport function withMain(Component) {\n  var _temp;\n\n  return _temp = class Main extends Component {\n    constructor(_props) {\n      super(_props);\n\n      this.onStoreUpdate = () => {\n        const onStoreChange = () => {\n          let storeUpdate = store.getState(); //if (!storeUpdate.question.visited && storeUpdate.question.newObject) {\n          //   console.log('redirecting to question page')\n          // this.redirecToQuestionPage(storeUpdate.question) \n          // }\n          //Open the Modal whenever modal is true.\n\n          this.openModal(storeUpdate.modal);\n        };\n\n        this.unsubscribe = store.subscribe(onStoreChange);\n      };\n\n      this.logout = () => {\n        localStorage.removeItem('@@CachedEntyties');\n\n        if (this.isAuthenticated()) {\n          localStorage.removeItem('@@CachedEntyties');\n          this.props.history.push('/user/registration');\n        } else {\n          localStorage.removeItem('@@CachedEntyties');\n          this.props.history.push('/user/registration');\n        }\n\n        ModalManager.close();\n      };\n\n      this.openModal = modal => {\n        //Open modal is open is true and close the if isOpen is false\n        //And most importantly render the modal with its contents based on the \n        //action dispatched \n        const modals = new Modals();\n\n        if (modal.isOpen) {\n          let modalProps = modal.modalProps; //Get Some important props and merge them with modalProps\n\n          let props = this.getProps();\n          Object.assign(props, modalProps);\n\n          if (modal.modalType === 'editor') {\n            modalProps['modalContents'] = React.createElement(AppEditor, Object.assign({}, props, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 174\n              },\n              __self: this\n            }));\n            console.log(modal, modalProps);\n            modals.editorModal(modal.modalProps);\n            setTimeout(() => {\n              this.setState({\n                modalIsOpen: true\n              });\n              this.props.history.push({}, '');\n            }, 10);\n          } else if (modal.modalType === 'optionsMenu') {\n            modalProps['modalContents'] = React.createElement(ModalOptionsMenu, Object.assign({}, props, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 184\n              },\n              __self: this\n            }));\n            modals.optionsMenuModal(modalProps);\n            setTimeout(() => {\n              this.setState({\n                modalIsOpen: true\n              });\n              this.props.history.push({}, '');\n            }, 10);\n          } else if (modal.modalType === 'dropImage') {\n            modalProps['modalContents'] = React.createElement(DropImage, Object.assign({}, props, {\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 194\n              },\n              __self: this\n            }));\n            modals.dropImageModal(modalProps);\n            setTimeout(() => {\n              this.setState({\n                modalIsOpen: true\n              });\n              this.props.history.push({}, '');\n            }, 10);\n          }\n        } else {\n          this.setState({\n            modalIsOpen: false\n          });\n          ModalManager.close();\n        }\n      };\n\n      this.redirecToQuestionPage = questionObj => {\n        questionObj = questionObj.newObject;\n\n        if (questionObj) {\n          let path = \"/question/\".concat(questionObj.slug, \"/\");\n          let currentUser = this.state.currentUser;\n          this.props.history.push(path, {\n            questionObj,\n            currentUser,\n            isNeQuestion: true\n          });\n        }\n      };\n\n      this.state = {\n        currentUser: '',\n        isAuthenticated: localStorage.getItem('auth') ? true : false,\n        modalIsOpen: false\n      };\n    }\n\n    isAuthenticated() {\n      let cachedEntyties = JSON.parse(localStorage.getItem('@@CachedEntyties'));\n\n      if (cachedEntyties) {\n        let auth = cachedEntyties.auth;\n\n        if (auth && auth.isLoggedIn) {\n          return true;\n        }\n      }\n\n      return false;\n    } //static getDerivedStateFromError(error) {\n    // Update state so the next render will show the fallback UI.\n    // return  dispatch => action.handleError(error);\n    //}\n    //componentDidCatch(error, info) {\n    // You can also log the error to an error reporting service\n    // console.log(error, info);\n    // }\n\n    /*\n    componentWillMount() {\n      //localStorage.removeItem('questionList');        \n    }*/\n\n\n    componentWillUnmount() {\n      this.unsubscribe();\n    }\n\n    componentWillReceiveProps(nextProps, prevProps) {\n      //let storeUpdate = store.getState();\n      if (this.state.modalIsOpen && this.props.history.action === \"POP\") {\n        if (this.state.modalIsOpen) {\n          store.dispatch(action.hideModal());\n        }\n      } else if (this.props.history && this.props.history.action === \"PUSH\") {//console.log(storeUpdate)\n      }\n    }\n\n    disableBack(e) {\n      if (this.state.modalIsOpen) {\n        e.returnValue = '';\n      }\n\n      e.preventDefault();\n    }\n\n    componentDidMount() {\n      this.onStoreUpdate(); //Subscribe on store change    \n\n      if (!this.isAuthenticated()) {\n        //User is not authenticated,so redirect to authentication page.\n        this.props.history.push('/user/registration/');\n      }\n\n      if (!this.getCurrentUser()) {\n        store.dispatch(getCurrentUser());\n      }\n    }\n\n    getCurrentUser() {\n      let cachedEntyties = JSON.parse(localStorage.getItem('@@CachedEntyties'));\n\n      if (cachedEntyties && cachedEntyties.currentUser) {\n        return cachedEntyties.currentUser.user;\n      }\n\n      return false;\n    }\n\n    unfollowOrDownVote(params) {\n      if (params.objName === \"question\" || params.objName === \"userProfile\" || params.objName === \"usersList\") {\n        var followers = params.obj.followers - 1;\n        params['formData'] = helper.createFormData({\n          followers\n        });\n      } else {\n        var upvotes = params.obj.upvotes - 1;\n        params['formData'] = helper.createFormData({\n          upvotes\n        });\n      }\n\n      this.props.submit(params); //handle subimiting downVotes or Unfollwers \n    }\n\n    followOrUpVote(params) {\n      if (params.objName === \"question\" || params.objName === \"userProfile\" || params.objName === \"usersList\") {\n        var followers = params.obj.followers + 1;\n        params['formData'] = helper.createFormData({\n          followers\n        });\n      } else {\n        var upvotes = params.obj.upvotes + 1;\n        params['formData'] = helper.createFormData({\n          upvotes\n        });\n      }\n\n      this.props.submit(params); //handle subimiting upvotes or follwers \n    }\n\n    push() {\n      this.props.history.pus(this.props, 'hello');\n    }\n\n    getProps() {\n      let props = {\n        logout: this.logout,\n        followOrUpVote: this.followOrUpVote.bind(this),\n        unfollowOrDownVote: this.unfollowOrDownVote.bind(this),\n        currentUser: this.getCurrentUser()\n      };\n      Object.assign(props, this.props);\n      return props;\n    }\n\n    render() {\n      let props = this.getProps();\n      console.log(props);\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 271\n        },\n        __self: this\n      }, React.createElement(Component, Object.assign({}, props, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 272\n        },\n        __self: this\n      })));\n    }\n\n  }, _temp;\n} //binds on `props` change\n\nconst mapDispatchToProps = (dispatch, ownProps) => {\n  return {\n    getIndex: () => dispatch(getIndex()),\n    getUserProfile: id => dispatch(getUserProfile(id)),\n    getUserList: props => dispatch(getUserList(props)),\n    getQuestionList: id => dispatch(_getQuestionList(id)),\n    getPostList: id => dispatch(getPostList(id)),\n    getQuestion: id => dispatch(getQuestion(id)),\n    getPost: id => dispatch(getPost(id)),\n    getCommentList: comment => dispatch(getCommentList(comment)),\n    getReplyList: props => dispatch(getReplyList(props)),\n    getReplyChildrenList: reply => dispatch(getReplyChildrenList(reply)),\n    getCurrentUser: apiUrl => dispatch(getCurrentUser()),\n    submit: props => dispatch(handleSubmit(props)),\n    showModal: props => dispatch(action.showModal(props)),\n    hideModal: props => dispatch(action.hideModal(props))\n  };\n};\n\nconst mapStateToProps = (state, ownProps) => {\n  return {\n    modal: state.modal,\n    entyties: state.entyties\n  };\n};\n\nconst composedHoc = compose(connect(mapStateToProps, mapDispatchToProps), withMain);\nexport default composedHoc;","map":{"version":3,"sources":["/home/silasi/Deprojectos/javascript_projects/wiplay-it-web-frontend/src/containers/higher-order-components/main.js"],"names":["React","ModalManager","connect","compose","handleSubmit","getCurrentUser","getPost","getUserList","getUserProfile","getPostList","getQuestion","getReplyList","getReplyChildrenList","getQuestionList","_getQuestionList","getCommentList","getIndex","action","ModalOptionsMenu","DropImage","AppEditor","store","Modals","Helper","helper","withMain","Component","Main","constructor","props","onStoreUpdate","onStoreChange","storeUpdate","getState","openModal","modal","unsubscribe","subscribe","logout","localStorage","removeItem","isAuthenticated","history","push","close","modals","isOpen","modalProps","getProps","Object","assign","modalType","console","log","editorModal","setTimeout","setState","modalIsOpen","optionsMenuModal","dropImageModal","redirecToQuestionPage","questionObj","newObject","path","slug","currentUser","state","isNeQuestion","getItem","cachedEntyties","JSON","parse","auth","isLoggedIn","componentWillUnmount","componentWillReceiveProps","nextProps","prevProps","dispatch","hideModal","disableBack","e","returnValue","preventDefault","componentDidMount","user","unfollowOrDownVote","params","objName","followers","obj","createFormData","upvotes","submit","followOrUpVote","pus","bind","render","mapDispatchToProps","ownProps","id","comment","reply","apiUrl","showModal","mapStateToProps","entyties","composedHoc"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport { ModalManager} from 'react-dynamic-modal';\nimport { connect } from 'react-redux';\nimport { compose } from 'redux';\nimport {handleSubmit, getCurrentUser,getPost, getUserList,\n         getUserProfile,getPostList,getQuestion,getReplyList,getReplyChildrenList,\n         getQuestionList as _getQuestionList,getCommentList, getIndex }  from \"dispatch/index\"\nimport  * as action  from 'actions/actionCreators';\n\n\nimport { ModalOptionsMenu } from \"components/buttons\";\nimport { DropImage } from \"containers/profile/edit_profile\";\nimport AppEditor  from 'containers/editor'\nimport {store} from \"index\";\n\n\nimport Modals from \"containers/modal-conf\";\nimport Helper from 'containers/utils/helpers';\n\n\n\n\nconst helper   = new Helper();\n\n\nexport function withMain(Component) {\n\n   return class Main extends Component {\n\n      constructor(props) {\n         super(props);\n\n         this.state = {\n            currentUser      : '',\n            isAuthenticated  :  localStorage.getItem('auth' )?true : false,\n            modalIsOpen      : false,\n         };\n          \n      }\n\n\n      isAuthenticated() {\n      \tlet cachedEntyties = JSON.parse(localStorage.getItem('@@CachedEntyties'));\n        \n        if (cachedEntyties){\n        \tlet { auth  }  = cachedEntyties;\n        \tif ( auth && auth.isLoggedIn){\n        \t\treturn true\n                \n        \t}\n        }\n\n        return false;\n      }\n\n      //static getDerivedStateFromError(error) {\n         // Update state so the next render will show the fallback UI.\n        // return  dispatch => action.handleError(error);\n      //}\n\n      \n      //componentDidCatch(error, info) {\n         // You can also log the error to an error reporting service\n        // console.log(error, info);\n     // }\n      /*\n      componentWillMount() {\n        //localStorage.removeItem('questionList');        \n      }*/\n\n      componentWillUnmount() {\n         this.unsubscribe();\n      }\n\n      ;\n\n      onStoreUpdate = () =>{\n \n         const onStoreChange = () => {\n            let storeUpdate = store.getState();\n            //if (!storeUpdate.question.visited && storeUpdate.question.newObject) {\n            //   console.log('redirecting to question page')\n              // this.redirecToQuestionPage(storeUpdate.question) \n           // }\n            //Open the Modal whenever modal is true.\n            this.openModal(storeUpdate.modal);\n         }\n\n         this.unsubscribe = store.subscribe(onStoreChange);\n\n      }\n\n      componentWillReceiveProps(nextProps, prevProps){ \n         //let storeUpdate = store.getState();\n         if (this.state.modalIsOpen && this.props.history.action === \"POP\") {\n            if (this.state.modalIsOpen) {\n                store.dispatch(action.hideModal())\n            }\n         }\n         else if (this.props.history && this.props.history.action === \"PUSH\") {\n            //console.log(storeUpdate)\n          }\n       \n      \n      }\n      \n      \n\n      disableBack(e) {\n                      \n         if (this.state.modalIsOpen) {\n            \n            e.returnValue = '';\n         }\n\n         e.preventDefault()\n      }\n\n      componentDidMount() {\n        this.onStoreUpdate() //Subscribe on store change    \n      \n        if (!this.isAuthenticated()) {\n            //User is not authenticated,so redirect to authentication page.\n            this.props.history.push('/user/registration/')\n        }\n\n        if(!this.getCurrentUser()){\n        \tstore.dispatch(getCurrentUser());\n        }\n      };\n\n\n    logout = () => {\n         \n        localStorage.removeItem('@@CachedEntyties')\n\n        if (this.isAuthenticated()) {\n            localStorage.removeItem('@@CachedEntyties')\n            this.props.history.push('/user/registration')\n        }else{\n        \tlocalStorage.removeItem('@@CachedEntyties')\n            this.props.history.push('/user/registration')\n\n        }\n\n        ModalManager.close();\n    }\n\n    getCurrentUser(){\n      \tlet cachedEntyties = JSON.parse(localStorage.getItem('@@CachedEntyties'));\n\n      \tif (cachedEntyties && cachedEntyties.currentUser) {\n      \t   return cachedEntyties.currentUser.user\n        }\n\n        return false;  \n      }\n\n\n\n    openModal = (modal) => {\n         //Open modal is open is true and close the if isOpen is false\n         //And most importantly render the modal with its contents based on the \n         //action dispatched \n         const modals   = new Modals();\n         if (modal.isOpen) {\n            let modalProps = modal.modalProps;\n            //Get Some important props and merge them with modalProps\n            let props = this.getProps()  \n            Object.assign(props, modalProps)\n\n            if (modal.modalType === 'editor') {\n               modalProps['modalContents'] =  <AppEditor {...props}/>;\n               console.log(modal, modalProps)\n               modals.editorModal(modal.modalProps);\n               setTimeout( () => {\n                   this.setState({modalIsOpen : true})\n                   this.props.history.push({},'')\n               }, 10);\n               \n            }\n            else if(modal.modalType === 'optionsMenu'){\n               modalProps['modalContents'] = <ModalOptionsMenu {...props}/>\n               modals.optionsMenuModal(modalProps)\n\n               setTimeout( () => {\n                   this.setState({modalIsOpen : true})\n                   this.props.history.push({},'')\n               }, 10);\n              \n            }\n            else if(modal.modalType === 'dropImage'){\n               modalProps['modalContents'] = <DropImage {...props}/>\n               modals.dropImageModal(modalProps)\n\n               setTimeout( () => {\n                   this.setState({modalIsOpen : true})\n                   this.props.history.push({},'')\n               }, 10);\n            }\n        \n\n         }else{\n            this.setState({modalIsOpen: false})\n            ModalManager.close();\n         }\n      }\n     \n      redirecToQuestionPage  = (questionObj) => {\n         questionObj = questionObj.newObject;\n         if (questionObj) {\n            let path = `/question/${questionObj.slug}/` \n            let currentUser = this.state.currentUser;\n            \n            this.props.history.push(path, {questionObj, currentUser, isNeQuestion:true})\n         }\n      };\n      \n      unfollowOrDownVote(params) {\n        \n         if (params.objName === \"question\" || params.objName === \"userProfile\" \n                                    || params.objName === \"usersList\" ) {\n            var followers     = params.obj.followers - 1;\n\n            params['formData'] = helper.createFormData({ followers });\n         }else{\n            var upvotes       = params.obj.upvotes - 1; \n            params['formData'] = helper.createFormData({upvotes})\n         }\n        this.props.submit(params); //handle subimiting downVotes or Unfollwers \n\n      };\n\n      followOrUpVote(params) {\n      \n         if (params.objName === \"question\" || params.objName === \"userProfile\"\n                                             || params.objName === \"usersList\") {\n            var followers     = params.obj.followers + 1;\n            params['formData'] = helper.createFormData({ followers });\n         }else{\n            var upvotes       = params.obj.upvotes + 1; \n            params['formData'] = helper.createFormData({upvotes})\n         }\n        this.props.submit(params); //handle subimiting upvotes or follwers \n             \n      };\n\n      push(){\n        this.props.history.pus(this.props, 'hello') \n      }\n     \n      getProps(){\n         let props = {\n            logout             : this.logout,\n            followOrUpVote     : this.followOrUpVote.bind(this),\n            unfollowOrDownVote : this.unfollowOrDownVote.bind(this),\n            currentUser        : this.getCurrentUser(),\n         };\n         \n         Object.assign(props, this.props );\n         return props;  \n         \n      }\n  \n\n      render() {\n         let props = this.getProps();\n         console.log(props)\n         return (\n              <div>\n                <Component {...props}/>\n              </div> \n\n            );\n      };\n\n   }\n}\n\n\n//binds on `props` change\nconst mapDispatchToProps = (dispatch, ownProps) => {\n   \n    return {\n    \tgetIndex             : ()        =>  dispatch(getIndex()), \n        getUserProfile       : (id)      => dispatch(getUserProfile(id)),\n        getUserList          : (props)   => dispatch(getUserList(props)),\n        getQuestionList      : (id)      => dispatch(_getQuestionList(id)),\n        getPostList          : (id)      => dispatch(getPostList(id)),\n        getQuestion          : (id)      => dispatch(getQuestion(id)),\n        getPost              : (id)      => dispatch(getPost(id)),\n        getCommentList       : (comment) => dispatch(getCommentList(comment)),\n        getReplyList         : (props)   => dispatch(getReplyList(props)),\n        getReplyChildrenList : (reply)   => dispatch(getReplyChildrenList(reply)),\n        getCurrentUser       : (apiUrl)  => dispatch(getCurrentUser()),\n        submit               : (props )  => dispatch(handleSubmit(props)), \n        showModal            : (props )  => dispatch(action.showModal(props)),\n        hideModal            : (props )  => dispatch(action.hideModal(props)),  \n   }\n\n};\n\n\n\n\nconst mapStateToProps = (state, ownProps) => {\n   \n    return {\n       modal         : state.modal,\n       entyties      : state.entyties,       \n    }\n};\n\nconst composedHoc = compose( connect(mapStateToProps, mapDispatchToProps),withMain )\n\n\nexport default  composedHoc;\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}